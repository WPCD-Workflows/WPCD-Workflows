

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11. Kepler &mdash; EUROfusion Integrated Modelling workflows 3.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. AMNS" href="amns.html" />
    <link rel="prev" title="10. Conventions" href="conventions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EUROfusion Integrated Modelling workflows
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction to the EUROfusion Project Code Development for integrated modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure.html">2. Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="ets.html">3. Core Transport Simulator (ETS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="edge.html">4. Edge Transport Simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="es.html">5. Equilibrium and MHD Stability workflow (EQSTABIL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="eqreconstr.html">6. The EQRECONSTRUCT workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="transport.html">7. Turbulent Flux Quantities in Transport Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="averages.html">8. Running Exponential Average</a></li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">9. Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">10. Conventions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Kepler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-to-kepler-basics">11.1. Introduction to Kepler - basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-kepler-and-tutorial-workflows">11.1.1. Installing Kepler and tutorial workflows</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kepler-imas-actors">11.2. Kepler IMAS actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#imas-kepler-based-configuration">11.3. IMAS Kepler based configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-kepler-using-imas-environment">11.3.1. Running Kepler using IMAS environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-environment">11.3.1.1. Setting up environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backing-up-old-files">11.3.1.2. Backing up old files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-place-to-store-your-personal-installations-of-kepler">11.3.1.3. Creating place to store your personal installations of Kepler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-kepler-default-release">11.3.1.4. Running Kepler (default release)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-embedding-user-codes-into-kepler">11.4. FC2K - Embedding user codes into Kepler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fc2k-basics">11.4.1. FC2K basics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-fc2k-actually-does">11.4.1.1. What FC2K actually does?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fc2k-main-window">11.4.1.2. FC2K main window</a></li>
<li class="toctree-l4"><a class="reference internal" href="#actor-description">11.4.1.3. Actor description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environment">11.4.1.4. Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arguments-tab-explained">11.4.1.5. “Arguments” tab explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameters-tab-explained">11.4.1.6. “Parameters” tab explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-tab-explained">11.4.1.7. “Source” tab explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#settings-tab-explained">11.4.1.8. “Settings” tab explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation-tab-explained">11.4.1.9. “Documentation” tab explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interface-tab-explained">11.4.1.10. “Interface” tab explained</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#incorporating-user-codes-into-kepler-using-fc2k-exercises">11.4.2. Incorporating user codes into Kepler using FC2K - exercises</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#embedding-fortran-codes-into-kepler">11.4.2.1. Embedding Fortran codes into Kepler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#embedding-c-codes">11.4.2.2. Embedding C++ codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-developer-guidelines">11.5. FC2K - developer guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-code-wrapper-actually-does">11.5.1. What code wrapper actually does?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#development-of-fortran-codes">11.5.2. Development of Fortran codes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#subroutine-syntax">11.5.2.1. Subroutine syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arguments-list">11.5.2.2. Arguments list</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-parameters">11.5.2.3. Code parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diagnostic-info">11.5.2.4. Diagnostic info</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">11.5.2.5. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#development-of-c-codes">11.5.3. Development of C++ codes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-syntax">11.5.3.1. Function syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">11.5.3.2. Arguments list</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">11.5.3.3. Code parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">11.5.3.4. Diagnostic info</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">11.5.3.5. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#delivery-of-the-user-code">11.5.4. Delivery of the user code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-example-1-embedding-fortran-codes-into-kepler-no-cpos">11.6. FC2K - Example 1 - Embedding Fortran codes into Kepler (no CPOs)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-familiar-with-codes-that-will-be-incorporated-into-kepler">11.6.1. Get familiar with codes that will be incorporated into Kepler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-code-by-issuing">11.6.2. Build the code by issuing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prepare-environment-for-fc2k">11.6.3. Prepare environment for FC2K</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-fc2k-application">11.6.4. Start FC2K application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#open-a-nocpo-example-1-project">11.6.5. Open a nocpo_example_1 project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-settings">11.6.6. Project settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#after-all-the-settings-are-correct-you-can-generate-actor">11.6.7. After all the settings are correct, you can generate actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#confirm-kepler-compilation">11.6.8. Confirm Kepler compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#you-can-now-start-kepler-and-use-generated-actor">11.6.9. You can now start Kepler and use generated actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#launch-the-workflow">11.6.10. Launch the workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-example-2-embedding-fortran-code-into-kepler-cpos">11.7. FC2K - Example 2 - Embedding Fortran code into Kepler (CPOs)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">11.7.1. Get familiar with codes that will be incorporated into Kepler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-code">11.7.2. Build the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">11.7.3. Prepare environment for FC2K</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">11.7.4. Start FC2K application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#open-project-cposlice2cposlicef-fc2k">11.7.5. Open project cposlice2cposlicef_fc2k</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">11.7.6. Project settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">11.7.7. After all the settings are correct, you can generate actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">11.7.8. Confirm Kepler compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">11.7.9. You can now start Kepler and use generated actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">11.7.10. Launch the workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-example-3-embedding-c-code-within-kepler-no-cpos">11.8. FC2K - Example 3 - Embedding C++ code within Kepler (no CPOs)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id14">11.8.1. Get familiar with codes that will be incorporated into Kepler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">11.8.2. Build the code by issuing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">11.8.3. Prepare environment for FC2K</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">11.8.4. Start FC2K application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#open-project-simplecppactor-nocpo">11.8.5. Open project simplecppactor_nocpo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">11.8.6. Project settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#actor-generation">11.8.7. Actor generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">11.8.8. Confirm Kepler compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">11.8.9. You can now start Kepler and use generated actor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">11.8.10. Launch the workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fc2k-example-4-embedding-c-code-within-kepler-cpos">11.9. FC2K - Example 4 - Embedding C++ code within Kepler (CPOs)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">11.9.1. Get familiar with codes that will be incorporated into Kepler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">11.9.2. Build the code by issuing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">11.9.3. Prepare environment for FC2K</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">11.9.4. Start FC2K application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#open-project-simplecppactor">11.9.5. Open project simplecppactor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">11.9.6. Project settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">11.9.7. Actor generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">11.9.8. Confirm Kepler compilation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">11.9.9. You can now start Kepler and use generated actor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#imas-kepler-2-1-3-default-release">11.10. IMAS Kepler 2.1.3 (default release)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-of-default-version-of-kepler-without-actors">11.10.1. Installation of default version of Kepler (without actors)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-of-dressed-version-of-kepler-with-actors">11.10.2. Installation of “dressed” version of Kepler (with actors)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#imas-kepler-2-1-5-release-candidate">11.11. IMAS Kepler 2.1.5 (release candidate)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-based-on-readme-file">11.12. Installation based on README file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="amns.html">12. AMNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">13. Additional resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EUROfusion Integrated Modelling workflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>11. Kepler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/WPCD-Workflows/documentation/blob/master/source/kepler.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kepler">
<span id="id1"></span><h1>11. Kepler<a class="headerlink" href="#kepler" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction-to-kepler-basics">
<h2>11.1. Introduction to Kepler - basics<a class="headerlink" href="#introduction-to-kepler-basics" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://kepler-project.org/">Kepler</a> is a workflow engine and design
platform for analyzing and modeling scientific data. Kepler provides a
graphical interface and a library of pre-defined components to enable users
to construct scientific workflows which can undertake a wide range of
functionality. It is primarily designed to access, analyse, and visualise
scientific data but can be used to construct whole programs or run
pre-existing simulation codes.</p>
<p>Kepler builds upon the mature Ptolemy II framework, developed at the
University of California, Berkeley. Kepler itself is developed and
maintained by the cross-project Kepler collaboration.</p>
<p>The main components in a Kepler workflow are actors, which are used in a
design (inherited from Ptolemy II) that separates workflow components
(“actors”) from workflow orchestration (“directors”), making components
more easily reusable. Workflows can work at very levels of granularity,
from low-level workflows (that explicitly move data around or start and
monitor remote jobs, for example) to high-level workflows that interlink
complex steps/actors. Actors can be reused to construct more complex
actors enabling complex functionality to be encapsulated in easy to use
packages. A wide range of actors are available for use and reuse.</p>
<div class="section" id="installing-kepler-and-tutorial-workflows">
<h3>11.1.1. Installing Kepler and tutorial workflows<a class="headerlink" href="#installing-kepler-and-tutorial-workflows" title="Permalink to this headline">¶</a></h3>
<p>You can download Kepler from the following page <a class="reference external" href="https://kepler-project.org/users/downloads">https://kepler-project.org/users/downloads</a></p>
<p>In order to install Kepler and tutorial related workflows you have to follow the instruction at</p>
<p><a class="reference external" href="https://confluence.man.poznan.pl/community/display/WFMS/5.3.+Kepler+Basics#id-5.3.KeplerBasics-1InstallingKepler">https://confluence.man.poznan.pl/community/display/WFMS/5.3.+Kepler+Basics#id-5.3.KeplerBasics-1InstallingKepler</a></p>
<p>Now you can start Kepler application and proceed to tutorial examples</p>
</div>
</div>
<div class="section" id="kepler-imas-actors">
<h2>11.2. Kepler IMAS actors<a class="headerlink" href="#kepler-imas-actors" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Imas actor</strong></th>
<th class="head"><strong>Deacription</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>UALSliceCollector</td>
<td><div class="first last line-block">
<div class="line">Store one slice from input IDS into
different run. This way, it is possible</div>
<div class="line">to collect intermediate results during
workflow execution.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>UALPython</td>
<td><div class="first last line-block">
<div class="line">Allows to run external Python process and
pass input/output data between workflow</div>
<div class="line">and process itself. This actor is, most
commonly, used for data visualization.</div>
<div class="line">User can pass Python script directly to
the actor.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>UALMuxParam</td>
<td><div class="first last line-block">
<div class="line">Provides similar behavior to
ualmux/UALMux, however, this actors has</div>
<div class="line">two additional ports:</div>
<div class="line-block">
<div class="line">- fieldDescription - contains name of
the filed that will be modified</div>
<div class="line">- fieldValue - contains new value of
the field</div>
</div>
<div class="line">Main difference between ualmux/
ualmuxparam
actors lays in it’s ability to be used
in</div>
<div class="line">a loop that modify different field
inside IDS.</div>
<div class="line">You can simply provide different field
name
for different loop’s step.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>UALMux</td>
<td><div class="first last line-block">
<div class="line">Provides a method for putting data inside
IDS inputs</div>
<div class="line-block">
<div class="line">- inputIds/inputCpo - cpo we are going
to modify</div>
<div class="line">- inTime - time index at which data are
supposed to be updated</div>
<div class="line">- name of the field is specified as port
name</div>
<div class="line">- new value of the field is passed as
value sent to the port</div>
</div>
<div class="line">outputs:</div>
<div class="line-block">
<div class="line">- outputIds/outputCpo - modified IDS</div>
<div class="line">- outTime - actual time index (depend
on approximation mode)</div>
</div>
</div>
</td>
</tr>
<tr class="row-even"><td>UALInit</td>
<td><div class="first last line-block">
<div class="line">Initializes input pulse file, creates
run work and provides ID S description</div>
<div class="line">for other actors
inputs:</div>
<div class="line-block">
<div class="line">- user - name of the user for input
data file (e.g. g2michal)</div>
<div class="line">- machine - name of the machine for
input data file (e.g. test/jet)</div>
<div class="line">- shot - shot number</div>
<div class="line">- run - run number</div>
<div class="line">- runwork - temporary run number
(place where output will be stored)</div>
</div>
<div class="line">outputs:</div>
<div class="line-block">
<div class="line">- error - description of error in case
there are problems while accessing
input data</div>
<div class="line">- all IDSess requested by user (each
IDS is specified as output port
name)</div>
</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>UALDemux</td>
<td><div class="first last line-block">
<div class="line">Allows to read data from given IDS -
name of the field is specified as</div>
<div class="line">output port.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>UALCollector</td>
<td><div class="first last line-block">
<div class="line">Stores input IDSess inside new run.
This way, it is possible to copy data</div>
<div class="line">into different shot/run rather than
inside run work.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>UALClose</td>
<td><div class="first last line-block">
<div class="line">Closes run work based on description
passed via input IDS.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>SetBreakpoint</td>
<td><div class="first last line-block">
<div class="line">This actor allows to enforce “debug”
mode for IMAS based actors. It sets</div>
<div class="line">global parameter “ITM_DEBUG” to either
true or false. In case true is a value</div>
<div class="line">of “ITM_DEBUG” all FC2K generated actors
will start in debug mode.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>RecordSet</td>
<td><div class="first last line-block">
<div class="line">Sets values inside record (take a look
for short tutorial: RecordGet/RecordSet)</div>
</div>
</td>
</tr>
<tr class="row-even"><td>RecordGet</td>
<td><div class="first last line-block">
<div class="line">Gets values from the record (take a
look here for short tutorial:</div>
<div class="line">RecordGet/RecordSet)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>IDSOccurence</td>
<td><div class="first last line-block">
<div class="line">Provides a method to create duplicate
of IDS with new occurrence number.</div>
<div class="line">This way, it is possible to store data
before they get modified by user code.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>IDSFlush</td>
<td><div class="first last line-block">
<div class="line">Flushes data from workflow. Data from
memory cache are stored inside database</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>IDSDiscard</td>
<td><div class="first last line-block">
<div class="line">Discards data inside workflow. Data will
be re-read into memory cache.</div>
</div>
</td>
</tr>
<tr class="row-even"><td>IDSContentStd</td>
<td><div class="first last line-block">
<div class="line">Displays IDS data on console (better
for huge data sets)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>IDSContent</td>
<td><div class="first last line-block">
<div class="line">Displays IDS data</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="imas-kepler-based-configuration">
<h2>11.3. IMAS Kepler based configuration<a class="headerlink" href="#imas-kepler-based-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-kepler-using-imas-environment">
<h3>11.3.1. Running Kepler using IMAS environment<a class="headerlink" href="#running-kepler-using-imas-environment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setting-up-environment">
<h4>11.3.1.1. Setting up environment<a class="headerlink" href="#setting-up-environment" title="Permalink to this headline">¶</a></h4>
<p>Please do not forget to set JAVA memory settings:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export _JAVA_OPTIONS=&quot;-Xss20m -Xms8g -Xmx8g&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="backing-up-old-files">
<h4>11.3.1.2. Backing up old files<a class="headerlink" href="#backing-up-old-files" title="Permalink to this headline">¶</a></h4>
<p>Before first configuration of Kepler, make sure to backup your old data files</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~</span>
<span class="go">mv .kepler .kepler~</span>
<span class="go">mv KeplerData KeplerData~</span>
<span class="go">mv .ptolemyII .ptolemyII~</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-place-to-store-your-personal-installations-of-kepler">
<h4>11.3.1.3. Creating place to store your personal installations of Kepler<a class="headerlink" href="#creating-place-to-store-your-personal-installations-of-kepler" title="Permalink to this headline">¶</a></h4>
<p>IMAS based installations are stored inside <strong>$HOME/kepler</strong> directory.</p>
<p>Before proceeding further, make sure to create <strong>kepler</strong> directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> create directory inside <span class="nv">$HOME</span>
<span class="go">cd ~</span>
<span class="go">mkdir kepler</span>
</pre></div>
</div>
</div>
<div class="section" id="running-kepler-default-release">
<h4>11.3.1.4. Running Kepler (default release)<a class="headerlink" href="#running-kepler-default-release" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>In order to start Kepler you have use helper scripts that will install and configure your personal copy of Kepler</dt>
<dd><ul class="first last">
<li><p class="first">load IMAS module</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="n">load</span> <span class="n">imas</span>
<span class="k">module </span><span class="n">load</span> <span class="n">kepler</span>
<span class="cp"># NOTE! It might be that you don&#39;t have Kepler copy inside your $HOME</span>
<span class="cp"># in that case you need to install it kepler_install_light</span>
</pre></div>
</div>
</li>
<li><p class="first">Start Kepler</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="cp"># run alias that will execute Kepler</span>
<span class="n">kepler</span>
</pre></div>
</div>
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="fc2k-embedding-user-codes-into-kepler">
<h2>11.4. FC2K - Embedding user codes into Kepler<a class="headerlink" href="#fc2k-embedding-user-codes-into-kepler" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is designed to introduce the concept of using FC2K tool in order to build Kepler compatible actors.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">This tutorial explains</span>
<span class="go">how to set up codes for FC2K</span>
<span class="go">how to build actor using FC2K</span>
<span class="go">how to incorporate actor within Kepler workflow</span>
</pre></div>
</div>
<div class="section" id="fc2k-basics">
<h3>11.4.1. FC2K basics<a class="headerlink" href="#fc2k-basics" title="Permalink to this headline">¶</a></h3>
<div class="section" id="what-fc2k-actually-does">
<h4>11.4.1.1. What FC2K actually does?<a class="headerlink" href="#what-fc2k-actually-does" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Generates a Fortran/CPP wrapper, which intermediates between Kepler actor and user code in terms of:<ul>
<li>reading/writing of in/out physical data (IDS)</li>
<li>passing arguments of standard types to/from the actor</li>
</ul>
</li>
<li>Creates a Kepler actor that:<ul>
<li>calls a user code</li>
<li>provides error handling</li>
<li>calls debugger (if run in “debug” mode)</li>
<li>calls batch submission commands for MPI based actors</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="fc2k-main-window">
<h4>11.4.1.2. FC2K main window<a class="headerlink" href="#fc2k-main-window" title="Permalink to this headline">¶</a></h4>
<img alt="_images/kepler_1.png" class="align-center" src="_images/kepler_1.png" />
</div>
<div class="section" id="actor-description">
<h4>11.4.1.3. Actor description<a class="headerlink" href="#actor-description" title="Permalink to this headline">¶</a></h4>
<img alt="_images/kepler_2.png" class="align-center" src="_images/kepler_2.png" />
<p>This group of graphical controls allows to set the description of the actor and its “place” in hierarchy of Kepler elements in Kepler “Component” browser</p>
<ul class="simple">
<li><strong>Project</strong> - defines a branch in Kepler “Component” browser where an actor will be placed</li>
<li><strong>Name</strong> - a user defined name of the actor</li>
<li><strong>Version</strong> - a user defined version of user codes</li>
<li><strong>Subroutine</strong> - A name of user subroutine (Fortran) or function (C++)</li>
</ul>
</div>
<div class="section" id="environment">
<h4>11.4.1.4. Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h4>
<img alt="_images/kepler_3.png" class="align-center" src="_images/kepler_3.png" />
<p>The Environment text fields shows UAL and Kepler locations.</p>
<ul class="simple">
<li><strong>Kepler</strong> - Kepler location (usually the same as $KEPLER)</li>
<li><strong>UAL</strong> - IMAS UAL location (usually the same as $IMAS_PREFIX)</li>
</ul>
</div>
<div class="section" id="arguments-tab-explained">
<h4>11.4.1.5. “Arguments” tab explained<a class="headerlink" href="#arguments-tab-explained" title="Permalink to this headline">¶</a></h4>
<p>Below you can find explanation of FC2K arguments tab.</p>
<img alt="_images/kepler_4.png" class="align-center" src="_images/kepler_4.png" />
<ul class="simple">
<li><strong>Type</strong> - Defines a type of an argument. It is possible to choose either IDS based type (e.g. equilibrium, topinfo, etc.) or primitive type (e.g. int, long, double, char)</li>
<li><strong>Single slice</strong> - Determines if IDS is passed as single slice or an array. (This setting is valid for IDS types only )<ul>
<li>if turned <strong>ON</strong> - Only one slice is passed. An actor will get an additional port to define a time.</li>
<li>if turned <strong>OFF</strong> - All IDSes for given shot run is passed.</li>
</ul>
</li>
<li><strong>Is array</strong> - Determines if a primitive type  is passed as a scalar or an array<ul>
<li>if turned <strong>ON</strong> - An argument is passed as an array. It requires definition of array size (dynamic array are not supported)</li>
<li>if turned <strong>OFF</strong> - An argument is passed as a scalar.</li>
</ul>
</li>
<li><strong>Array size</strong> - Defines the size of an array of primitive types</li>
<li><strong>Input</strong> - Defines argument as an input</li>
<li><strong>Output</strong> - Defines argument as an output</li>
<li><strong>Label</strong> - User defined name of an argument (and actor port)</li>
</ul>
<img alt="_images/kepler_5.png" class="align-center" src="_images/kepler_5.png" />
<p>Please take a look on a screenshot above:</p>
<ul class="simple">
<li><em>equilibrium</em> - an input parameter - one IDS (slice)</li>
<li><em>amns</em> - an input parameter - all amns IDS slices stored in given shot/run</li>
<li><em>integer</em> - an input parameter - a scalar</li>
<li><em>double</em> - an input parameter - an array of size 10</li>
<li><em>edge</em> - an in/out parameter - single slice of “edge” IDS</li>
<li><em>waves</em> - an output parameter - all slices of “waves” IDS</li>
</ul>
</div>
<div class="section" id="parameters-tab-explained">
<h4>11.4.1.6. “Parameters” tab explained<a class="headerlink" href="#parameters-tab-explained" title="Permalink to this headline">¶</a></h4>
<p>Code specific parameters are all parameters which are specific to the code (like switches, scaling parameters, and parameters for built-in analytical models) as well as parameters to explicitly overrule fields in the ITM data structures.</p>
<img alt="_images/kepler_6.png" class="align-center" src="_images/kepler_6.png" />
<ul class="simple">
<li><strong>Frequently Used XML</strong> - Actual value of the code parameters</li>
<li><strong>Default XML</strong> - Default values of the code parameters</li>
<li><strong>Schema</strong> - A (XSD) XML schema</li>
</ul>
</div>
<div class="section" id="source-tab-explained">
<h4>11.4.1.7. “Source” tab explained<a class="headerlink" href="#source-tab-explained" title="Permalink to this headline">¶</a></h4>
<img alt="_images/kepler_7.png" class="align-center" src="_images/kepler_7.png" />
<p>The purpose of this tab is to define all code related issues:</p>
<ul class="simple">
<li>a programming language</li>
<li>utilized compiler,</li>
<li>type of code execution (sequential of parallel)</li>
<li>libraries being used</li>
</ul>
<div class="section" id="libraries">
<h5>11.4.1.7.1. Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h5>
<p><em>“Main library”</em></p>
<p>A “Main library” field allows to define a path to library containing user subroutine/function.</p>
<img alt="_images/kepler_8.png" class="align-center" src="_images/kepler_8.png" />
<p><em>“Optional library”</em></p>
<p>A “Optional library” field allows to define a path to optional library containing user subroutine/function.</p>
<p><em>“Custom libraries”</em></p>
<p>“Custom libraries” are non-standard static libraries required for building the user code.</p>
<img alt="_images/kepler_9.png" class="align-center" src="_images/kepler_9.png" />
<p>Available operations on libraries list:</p>
<ul class="simple">
<li><em>“Add…”</em> - Adds a new library to the list</li>
<li><em>“Edit…”</em> - Edits library path</li>
<li><em>“Remove”</em> - Removes a new library from the list</li>
</ul>
<p><em>“System libraries”</em></p>
<p>“System libraries” are system libraries handled by pkg-config mechanism and required for building the user code.</p>
<img alt="_images/kepler_10.png" class="align-center" src="_images/kepler_10.png" />
<p>A user can:</p>
<ul class="simple">
<li>add library from the list,</li>
<li>remove library</li>
<li>display detailed info (library definition returned by pkg-config mechanism)</li>
</ul>
<img alt="_images/kepler_11.png" class="align-center" src="_images/kepler_11.png" />
</div>
</div>
<div class="section" id="settings-tab-explained">
<h4>11.4.1.8. “Settings” tab explained<a class="headerlink" href="#settings-tab-explained" title="Permalink to this headline">¶</a></h4>
<p>A user, using this tab, selects programming language of codes provided, compiler used to built library and type of code execution (sequential or parallel)</p>
<img alt="_images/kepler_12.png" class="align-center" src="_images/kepler_12.png" />
<ul>
<li><p class="first"><strong>Programming languange:</strong></p>
<blockquote>
<div><ul>
<li><p class="first"><strong>Type</strong> - Defines programming language of user codes. It could be set to:</p>
<blockquote>
<div><ul class="simple">
<li>Fortran</li>
<li>_C/C++</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Compiler</strong> - Defines compiler being used. Possible values:</p>
<blockquote>
<div><ul class="simple">
<li>ifort, gfortran</li>
<li>gcc, g++</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Computation:</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>Parallel MPI</strong> - If turned <strong>ON</strong> uses MPI compilers (mpiifort for ifort, mpif90 for gfortran, mpigxx for C)</li>
<li><strong>OPENMP</strong> - Defined if usage of OpenMP directives is turned ON/OFF</li>
<li><strong>Batch</strong> - If turned <strong>ON</strong>, submits a user code to jobs queue (combined with Parallel MPI or OPENMP switch runs user code as parallel job)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Additional features:</strong></p>
<blockquote>
<div><ul class="simple">
<li><strong>Calls init method</strong> - If user function needs any pre-initialization, an additional function will be called.</li>
<li><strong>Returns diagnostic info</strong> - adds output diagnostic information</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="documentation-tab-explained">
<h4>11.4.1.9. “Documentation” tab explained<a class="headerlink" href="#documentation-tab-explained" title="Permalink to this headline">¶</a></h4>
<p>The “Documentation” tab specifies an user-defined Kepler actor description. It could be displayed from actor pop-up menu.</p>
<img alt="_images/kepler_13.png" class="align-center" src="_images/kepler_13.png" />
</div>
<div class="section" id="interface-tab-explained">
<h4>11.4.1.10. “Interface” tab explained<a class="headerlink" href="#interface-tab-explained" title="Permalink to this headline">¶</a></h4>
<p>The “Interface” tab specifies interface for Kepler actor.</p>
<img alt="_images/kepler_14.png" class="align-center" src="_images/kepler_14.png" />
</div>
</div>
<div class="section" id="incorporating-user-codes-into-kepler-using-fc2k-exercises">
<h3>11.4.2. Incorporating user codes into Kepler using FC2K - exercises<a class="headerlink" href="#incorporating-user-codes-into-kepler-using-fc2k-exercises" title="Permalink to this headline">¶</a></h3>
<p>In this part of the tutorial you will learn how to incorporate Fortran and C++ codes into Kepler.</p>
<p>Hands-on exercises show:</p>
<ul class="simple">
<li>how to prepare C++ codes for FC2K</li>
<li>how to prepare C++ library</li>
<li>how set up Makefile</li>
<li>how start and configure FC2K tool</li>
</ul>
<div class="section" id="embedding-fortran-codes-into-kepler">
<h4>11.4.2.1. Embedding Fortran codes into Kepler<a class="headerlink" href="#embedding-fortran-codes-into-kepler" title="Permalink to this headline">¶</a></h4>
<p><strong>Simple Fortran code</strong></p>
<p>In this exercise you will execute simple Fortran code (multiplying input value by two) within Kepler.</p>
<p><a class="reference internal" href="#exercise1">Exercise1</a></p>
<p><strong>Fortran UAL example (CPO handling)</strong></p>
<p>In this exercise you will create Kepler actor that uses UAL.</p>
<p><a class="reference internal" href="#exercise2">Exercise2</a></p>
</div>
<div class="section" id="embedding-c-codes">
<h4>11.4.2.2. Embedding C++ codes<a class="headerlink" href="#embedding-c-codes" title="Permalink to this headline">¶</a></h4>
<p><strong>Simple C++ code</strong></p>
<p>Simple C++ code that will be incorporated into Kepler via FC2K tool - addition of one to the value passed into input port of the actor</p>
<p><a class="reference internal" href="#exercise3">Exercise3</a></p>
<p><strong>C++ code within Kepler (CPO)</strong></p>
<p>In this exercise you will create Kepler actor that uses UAL.</p>
<p><a class="reference internal" href="#exercise4">Exercise4</a></p>
</div>
</div>
</div>
<div class="section" id="fc2k-developer-guidelines">
<h2>11.5. FC2K - developer guidelines<a class="headerlink" href="#fc2k-developer-guidelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-code-wrapper-actually-does">
<h3>11.5.1. What code wrapper actually does?<a class="headerlink" href="#what-code-wrapper-actually-does" title="Permalink to this headline">¶</a></h3>
<p>The code wrapper intermediates between Kepler actor and user code:</p>
<ul class="simple">
<li>Passes variables of language built-in types (int, char, etc) from actor to the code</li>
<li>Reads CPO(s) from UAL and passes data to user code</li>
<li>Passes input code parameters (XML/XSD files) to user code</li>
<li>Calls user subroutine/function</li>
<li>Saves output CPO(s)</li>
</ul>
</div>
<div class="section" id="development-of-fortran-codes">
<h3>11.5.2. Development of Fortran codes<a class="headerlink" href="#development-of-fortran-codes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="subroutine-syntax">
<h4>11.5.2.1. Subroutine syntax<a class="headerlink" href="#subroutine-syntax" title="Permalink to this headline">¶</a></h4>
<p>subroutine name (&lt;in/out arguments list&gt; [,code_parameters] [,diagnostic_info])</p>
<ul class="simple">
<li>name - subroutine name</li>
<li>in/out arguments list - a list of input and output subroutine arguments</li>
<li>diagnostic_info - arbitrary output diagnostic information</li>
</ul>
</div>
<div class="section" id="arguments-list">
<h4>11.5.2.2. Arguments list<a class="headerlink" href="#arguments-list" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">A mandatory position</p>
</li>
<li><p class="first">A list of input and output subroutine arguments including:</p>
<blockquote>
<div><ul>
<li><p class="first">Fortran intrisic data types, eg:</p>
<blockquote>
<div><ul class="simple">
<li>integer :: input</li>
<li>character(50) :: charstring</li>
<li>integer,dimension(4) :: tabint</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">CPOs, eg:</p>
<blockquote>
<div><ul class="simple">
<li>type (type_equilibrium),pointer :: equilibriumin(:)</li>
<li>type (type_distsource),pointer :: distsourceout(:)</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="code-parameters">
<h4>11.5.2.3. Code parameters<a class="headerlink" href="#code-parameters" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>user defined input parameters</li>
<li>input / optional</li>
<li>Argument of type: type_param</li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">type type_param  !</span>
<span class="go">    character(len=132), dimension(:), pointer ::parameters</span>
<span class="go">    character(len=132), dimension(:), pointer ::default_param</span>
<span class="go">    character(len=132), dimension(:), pointer ::schema</span>
<span class="go">endtype</span>
</pre></div>
</div>
<ul class="simple">
<li>Derived type type_param describes:<ul>
<li>parameters - Actual value of the code parameters (instance of coparam/parameters in XML format).</li>
<li>default_param - Default value of the code parameters (instance of coparam/parameters in XML format).</li>
<li>schema - Code parameters schema.</li>
</ul>
</li>
<li>An example:<ul>
<li>(type_param) :: codeparam{{</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="diagnostic-info">
<h4>11.5.2.4. Diagnostic info<a class="headerlink" href="#diagnostic-info" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">arbitrary output diagnostic information</p>
<blockquote>
<div><ul class="simple">
<li>output / optional</li>
</ul>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">!----  Diagnostic info  ----</span>
<span class="go">integer, intent(out)     ::     user_out_outputFlag</span>
<span class="go">character(len=:), pointer, intent(out)    ::    user_out_diagnosticInfo</span>
</pre></div>
</div>
</li>
<li><p class="first">outputFlag - indicates if user subroutine was successfully executed</p>
<blockquote>
<div><ul class="simple">
<li>outpuflag = 0    - SUCCESS, no action is taken</li>
<li>outputFlag &gt; 0  - WARNING, a warning message is displayed, workflow continuue execution</li>
<li>outputFlag &lt; 0 - ERROR, actor throws an exception, workflow stops</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">diagnosticInfo - an arbitrary string</p>
</li>
</ul>
</div>
<div class="section" id="examples">
<h4>11.5.2.5. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Example</span> <span class="mi">1</span> <span class="n">Simple</span> <span class="n">in</span><span class="o">/</span><span class="n">out</span> <span class="n">argument</span> <span class="n">types</span><span class="o">**</span>
<span class="k">subroutine </span><span class="n">nocpo</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="n">input</span>
   <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="kd">::</span> <span class="n">output</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 2 A CPO array as a subroutine argument**</span>
<span class="go">subroutine equil2dist(equilibriumin, distsourceout)</span>
<span class="go">    use euITM_schemas</span>
<span class="go">    implicit none</span>

<span class="go">    !input</span>
<span class="go">    type (type_equilibrium), pointer :: equilibriumin(:)</span>
<span class="go">    !output</span>
<span class="go">    type (type_distsource), pointer :: distsourceout(:)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 3 Usage of code input parameters**</span>
<span class="go">subroutine teststring(coreprof,equi,tabint,tabchar,codeparam)</span>
<span class="go">    use euITM_schemas</span>

<span class="go">    implicit none</span>

<span class="go">!input</span>
<span class="go">    type(type_coreprof),pointer,dimension(:) :: coreprof</span>
<span class="go">    integer, dimension(4), intent(in) :: tabint</span>

<span class="go">!output</span>
<span class="go">    type(type_equilibrium),pointer,dimension(:) :: equi</span>
<span class="go">    character(50), intent(out) :: tabchar</span>

<span class="go">!code parameters</span>
<span class="go">    type(type_param), intent(in) :: codeparam</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="development-of-c-codes">
<h3>11.5.3. Development of C++ codes<a class="headerlink" href="#development-of-c-codes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="function-syntax">
<h4>11.5.3.1. Function syntax<a class="headerlink" href="#function-syntax" title="Permalink to this headline">¶</a></h4>
<p>void name ( &lt;in/out arguments list&gt; [,code_parameters] [,diagnostic_info] )</p>
<blockquote>
<div><ul class="simple">
<li>name - function name</li>
<li>code_parameters - optional - user defined input parameters</li>
<li>diagnostic_info -  arbitrary output diagnostic information</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id2">
<h4>11.5.3.2. Arguments list<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">in/out arguments list</p>
</li>
<li><p class="first">mandatory</p>
</li>
<li><p class="first">a list of input and output function arguments including:</p>
<blockquote>
<div><ul class="simple">
<li>CPP intrisic data types, eg:<ul>
<li>int &amp;x</li>
<li>double &amp;y</li>
</ul>
</li>
<li>CPOs, eg:<ul>
<li>ItmNs::Itm::antennas &amp; ant</li>
<li>ItmNs::Itm::equilibriumArray &amp; eq</li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id3">
<h4>11.5.3.3. Code parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul>
<li><p class="first">Optional</p>
</li>
<li><p class="first">User defined input parameters</p>
</li>
<li><p class="first">Argument of type: ItmNs:: codeparam_t &amp;</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">typedef struct {</span>
<span class="go">   char **parameters;</span>
<span class="go">   char **default_param;</span>
<span class="go">   char **schema;</span>
<span class="go">} codeparam_t;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">A structure codeparam_t describes:</p>
<blockquote>
<div><ul class="simple">
<li>parameters - Actual value of the code parameters (instance of coparam/parameters in XML format).</li>
<li>default_param - Default value of the code parameters (instance of coparam/parameters in XML format).</li>
<li>schema - Code parameters schema.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">An example: ItmNs::codeparam_t &amp; codeparam</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id4">
<h4>11.5.3.4. Diagnostic info<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>arbitrary output diagnostic information</li>
<li>output / optional</li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">void name(...., int* output_flag, char** diagnostic_info)</span>
</pre></div>
</div>
<ul>
<li><p class="first">output_flag - indicates if user subroutine was successfully executed</p>
<blockquote>
<div><ul class="simple">
<li>output_flag = 0  - SUCCESS, no action is taken</li>
<li>output_flag &gt; 0  - WARNING, a warning message is displayed, workflow continuue execution</li>
<li>output_flag &lt; 0  - ERROR, actor throws an exception, workflow stops</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">diagnostic_info - an arbitrary string</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id5">
<h4>11.5.3.5. Examples<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 4. Simple in/out argument types**</span>
<span class="go">void simplecppactornocpo(double &amp;x, double &amp;y)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 5. A CPO array as a function argument**</span>
<span class="go">void simplecppactor(ItmNs::Itm::equilibriumArray &amp;eq, double &amp;x, double &amp;y)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 6. Usage of init function and code input parameters**</span>
<span class="go">void mycppfunctionbis_init();</span>
<span class="go">void mycppfunction(ItmNs::Itm::summary&amp; sum, ItmNs::Itm::equilibriumArray&amp; eq, int&amp; x, ItmNs::Itm::coreimpur&amp; cor,  double&amp;  y, ItmNs::codeparam_t&amp; codeparam)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="delivery-of-the-user-code">
<h3>11.5.4. Delivery of the user code<a class="headerlink" href="#delivery-of-the-user-code" title="Permalink to this headline">¶</a></h3>
<p>The user code should be delivered as a static library.
Please find examples of the simple “makefiles” below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 6. Building of Fortran code**</span>
<span class="go">F90 = $(ITM_INTEL_FC)</span>
<span class="go">COPTS = -g -O0 -assume no2underscore -fPIC -shared-intel</span>

<span class="go">INCLUDES = $(shell eval-pkg-config --cflags ual-$(ITM_INTEL_OBJECTCODE))</span>

<span class="go">all: equilibrium2distsource.o libequilibrium2distsource</span>

<span class="go">libequilibrium2distsource: equilibrium2distsource.o</span>
<span class="go">       ar -rvs libequilibrium2distsource.a equilibrium2distsource.o</span>

<span class="go">equilibrium2distsource.o: equilibrium2distsource.f90</span>
<span class="gp">       $</span><span class="o">(</span>F90<span class="o">)</span> <span class="k">$(</span>COPTS<span class="k">)</span> -c -o <span class="nv">$@</span> $^ <span class="si">${</span><span class="nv">INCLUDES</span><span class="si">}</span>

<span class="go">clean:</span>
<span class="go">      rm -f *.o *.a</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">**Example 7. Building of C++ code**</span>
<span class="go">CXX=g++</span>
<span class="go">CXXFLAGS= -g -fPIC</span>
<span class="go">CXXINCLUDES= ${shell eval-pkg-config --cflags ual-cpp-gnu}</span>

<span class="go">all: libsimplecppactor.a</span>

<span class="go">libsimplecppactor.a: simplecppactor.o</span>
<span class="go">     ar -rvs $@ $^</span>

<span class="go">simplecppactor.o: simplecppactor.cpp</span>
<span class="gp">     $</span><span class="o">(</span>CXX<span class="o">)</span> <span class="k">$(</span>CXXFLAGS<span class="k">)</span> <span class="k">$(</span>CXXINCLUDES<span class="k">)</span> -c -o <span class="nv">$@</span> $^

<span class="go">clean:</span>
<span class="go">     rm *.a *.o</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fc2k-example-1-embedding-fortran-codes-into-kepler-no-cpos">
<span id="exercise1"></span><h2>11.6. FC2K - Example 1 - Embedding Fortran codes into Kepler (no CPOs)<a class="headerlink" href="#fc2k-example-1-embedding-fortran-codes-into-kepler-no-cpos" title="Permalink to this headline">¶</a></h2>
<p><strong>The knowledge gained</strong>
<strong>After this exercise you will:</strong></p>
<ul class="simple">
<li>know how to prepare Fortran codes for FC2K</li>
<li>know how to build Fortran library</li>
<li>know how set up Makefile</li>
<li>know how start and configure FC2K tool</li>
</ul>
<p>In this exercise you will execute simple Fortran code within Kepler. In order to this follow the instructions:</p>
<div class="section" id="get-familiar-with-codes-that-will-be-incorporated-into-kepler">
<h3>11.6.1. Get familiar with codes that will be incorporated into Kepler<a class="headerlink" href="#get-familiar-with-codes-that-will-be-incorporated-into-kepler" title="Permalink to this headline">¶</a></h3>
<p>Go to Code Camp related materials within your home directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; cd $TUTORIAL_DIR/FC2K/nocpo_example_1</span>
</pre></div>
</div>
<p>You can find there various files. Pay particular attention to following ones:</p>
<ul class="simple">
<li>nocpo.f90 - Fortran source code that will be executed from Kepler</li>
<li>Makefile - makefile that allows to build library file</li>
<li>nocpo_fc2k.xml - parameters for FC2K application (NOTE! this file contains my own settings, we will modify them during tutorial)</li>
<li>nocpo.xml - example workflow</li>
</ul>
</div>
<div class="section" id="build-the-code-by-issuing">
<h3>11.6.2. Build the code by issuing<a class="headerlink" href="#build-the-code-by-issuing" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; make clean</span>
<span class="go">shell&gt; make</span>
</pre></div>
</div>
<p>Codes are ready to be used within FC2K</p>
</div>
<div class="section" id="prepare-environment-for-fc2k">
<h3>11.6.3. Prepare environment for FC2K<a class="headerlink" href="#prepare-environment-for-fc2k" title="Permalink to this headline">¶</a></h3>
<p>Make sure that all required system settings are correctly set</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
</pre></div>
</div>
</div>
<div class="section" id="start-fc2k-application">
<h3>11.6.4. Start FC2K application<a class="headerlink" href="#start-fc2k-application" title="Permalink to this headline">¶</a></h3>
<p>This is as simple as typing <strong>fc2k</strong> from terminal</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; fc2k</span>
</pre></div>
</div>
<p>After a while, you should see FC2K’s main window.</p>
</div>
<div class="section" id="open-a-nocpo-example-1-project">
<h3>11.6.5. Open a nocpo_example_1 project<a class="headerlink" href="#open-a-nocpo-example-1-project" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Choose <strong>File -&gt; Open</strong> and navigate to <strong>$TUTORIAL_DIR/FC2K/nocpo_example_1.</strong></li>
<li>Open file <strong>nocpo_fc2k.xml.</strong></li>
<li>You should see new parameter settings loaded into FC2K.</li>
<li>After loading parameters you can notice that parameters point to locations within your home directory.</li>
</ol>
<img alt="_images/kepler_15.png" class="align-center" src="_images/kepler_15.png" />
</div>
<div class="section" id="project-settings">
<h3>11.6.6. Project settings<a class="headerlink" href="#project-settings" title="Permalink to this headline">¶</a></h3>
<p>Please take a look at the project settings.</p>
<img alt="_images/kepler_16.png" class="align-center" src="_images/kepler_16.png" />
<p>Subroutine arguments:</p>
<ul class="simple">
<li>one input argument of type integer</li>
<li>one output argument of type integer</li>
</ul>
<img alt="_images/kepler_17.png" class="align-center" src="_images/kepler_17.png" />
</div>
<div class="section" id="after-all-the-settings-are-correct-you-can-generate-actor">
<h3>11.6.7. After all the settings are correct, you can generate actor<a class="headerlink" href="#after-all-the-settings-are-correct-you-can-generate-actor" title="Permalink to this headline">¶</a></h3>
<p>Simply press “Generate” button and wait till FC2K finishes the generation.</p>
</div>
<div class="section" id="confirm-kepler-compilation">
<h3>11.6.8. Confirm Kepler compilation<a class="headerlink" href="#confirm-kepler-compilation" title="Permalink to this headline">¶</a></h3>
<p>After actor is generated, FC2K offers to compile Kepler application. Make sure to compile it by pressing “Yes”.</p>
<img alt="_images/kepler_18.png" class="align-center" src="_images/kepler_18.png" />
</div>
<div class="section" id="you-can-now-start-kepler-and-use-generated-actor">
<h3>11.6.9. You can now start Kepler and use generated actor<a class="headerlink" href="#you-can-now-start-kepler-and-use-generated-actor" title="Permalink to this headline">¶</a></h3>
<p>Open new terminal window and make sure that all environment settings are correctly set and execute Kepler.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
<span class="go">shell&gt; kepler.sh</span>
</pre></div>
</div>
<p>After Kepler is started, open example workflow from the following location</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>TUTORIAL_DIR/FC2K/nocpo_example_1/nocpo.xml
</pre></div>
</div>
<p>You should see similar workflow on screen.</p>
<img alt="_images/kepler_19.png" class="align-center" src="_images/kepler_19.png" />
</div>
<div class="section" id="launch-the-workflow">
<h3>11.6.10. Launch the workflow<a class="headerlink" href="#launch-the-workflow" title="Permalink to this headline">¶</a></h3>
<p>You can start the workflow execution, by pressing “Play” button</p>
<img alt="_images/kepler_20.png" class="align-center" src="_images/kepler_20.png" />
<p>After workflow finishes it’s execution, you should see result similar to one below:</p>
<img alt="_images/kepler_21.png" class="align-center" src="_images/kepler_21.png" />
<p>Exercise no. 1 finishes here.</p>
</div>
</div>
<div class="section" id="fc2k-example-2-embedding-fortran-code-into-kepler-cpos">
<span id="exercise2"></span><h2>11.7. FC2K - Example 2 - Embedding Fortran code into Kepler (CPOs)<a class="headerlink" href="#fc2k-example-2-embedding-fortran-code-into-kepler-cpos" title="Permalink to this headline">¶</a></h2>
<p><strong>Exercise no. 2.</strong></p>
<p><em>Fortran example (CPO handling)</em></p>
<p>(approx. 30 min)</p>
<p><strong>The knowledge gained</strong></p>
<p><strong>After this exercise you will:</strong></p>
<blockquote>
<div><ul class="simple">
<li>know how to prepare Fortran codes that use UAL</li>
<li>know how to prepare Fortran based library that uses UAL</li>
<li>know how set up Makefile</li>
<li>know how start and configure FC2K tool</li>
</ul>
</div></blockquote>
<p>In this exercise you will execute simple Fortran code that uses UAL. Code will be incorporated into Kepler. In order to do this follow the instructions:</p>
<div class="section" id="id6">
<h3>11.7.1. Get familiar with codes that will be incorporated into Kepler<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Go to Code Camp related materials within your home directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; cd $TUTORIAL_DIR/FC2K/equilibrium2distsource/</span>
</pre></div>
</div>
<p>You can find there various files. Pay particular attention to following ones:</p>
<blockquote>
<div><ul class="simple">
<li>equilibrium2distsource.f90 - Fortran source code that will be executed fromKepler - this code uses UAL</li>
<li>Makefile - makefile that allows to build library file</li>
<li>cposlice2cposlicef_fc2k.xml - parameters for FC2K application (NOTE! this file contains my own settings, we will modify them during tutorial)</li>
<li>cposlice2cposlicef_kepler.xml - example workflow</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="build-the-code">
<h3>11.7.2. Build the code<a class="headerlink" href="#build-the-code" title="Permalink to this headline">¶</a></h3>
<p>A Fortran example could be built by issuing</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; make clean -f make_ifort</span>
<span class="go">shell&gt; make -f make_ifort</span>
</pre></div>
</div>
<p>Codes are ready to be used within FC2K</p>
</div>
<div class="section" id="id7">
<h3>11.7.3. Prepare environment for FC2K<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Make sure that all required system settings are correctly set</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>11.7.4. Start FC2K application<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>This is as simple as typing fc2k from terminal</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; fc2k</span>
</pre></div>
</div>
<p>After a while, you should see FC2K’s main window</p>
</div>
<div class="section" id="open-project-cposlice2cposlicef-fc2k">
<h3>11.7.5. Open project cposlice2cposlicef_fc2k<a class="headerlink" href="#open-project-cposlice2cposlicef-fc2k" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Choose <strong>File -&gt; Open</strong></li>
<li>Navigate to $TUTORIAL_DIR/FC2K/equilibrium2distsource/.</li>
<li>Open file cposlice2cposlicef_fc2k.xml.</li>
<li>You should see new project loaded into FC2K.</li>
</ol>
<img alt="_images/kepler_22.png" class="align-center" src="_images/kepler_22.png" />
</div>
<div class="section" id="id9">
<h3>11.7.6. Project settings<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Please take a look at the project settings.</p>
<img alt="_images/kepler_23.png" class="align-center" src="_images/kepler_23.png" />
<p>Subroutine arguments:</p>
<ul class="simple">
<li>one input argument - CPO array</li>
<li>one output argument - CPO array</li>
</ul>
<img alt="_images/kepler_24.png" class="align-center" src="_images/kepler_24.png" />
<p>After loading parameters you can notice that library location points to location within your itmwork directory <strong>($ITMWORK)</strong>.</p>
</div>
<div class="section" id="id10">
<h3>11.7.7. After all the settings are correct, you can generate actor<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Simply press “Generate” button and wait till FC2K finishes the generation.</p>
</div>
<div class="section" id="id11">
<h3>11.7.8. Confirm Kepler compilation<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>After actor is generated, FC2K offers to compile Kepler application. Make sure to compile it by pressing “Yes”.</p>
<img alt="_images/kepler_25.png" class="align-center" src="_images/kepler_25.png" />
</div>
<div class="section" id="id12">
<h3>11.7.9. You can now start Kepler and use generated actor<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Open new terminal window and make sure that all environment settings are correctly set and execute Kepler.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
<span class="go">shell&gt; kepler.sh</span>
</pre></div>
</div>
<p>After Kepler is started, open example workflow from the following location</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">shell&gt; $</span>TUTORIAL_DIR/FC2K/equilibrium2distsource/cposlice2cposlicef_kepler.xml
</pre></div>
</div>
<p>You should see similar workflow on screen.</p>
<img alt="_images/kepler_26.png" class="align-center" src="_images/kepler_26.png" />
</div>
<div class="section" id="id13">
<h3>11.7.10. Launch the workflow<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>You can start the workflow execution, by pressing “Play” button</p>
<img alt="_images/kepler_27.png" class="align-center" src="_images/kepler_27.png" />
<p>After workflow finishes it’s execution, you should see result similar to one below:</p>
<img alt="_images/kepler_28.png" class="align-center" src="_images/kepler_28.png" />
<p>Exercise no. 2 finishes here.</p>
</div>
</div>
<div class="section" id="fc2k-example-3-embedding-c-code-within-kepler-no-cpos">
<span id="exercise3"></span><h2>11.8. FC2K - Example 3 - Embedding C++ code within Kepler (no CPOs)<a class="headerlink" href="#fc2k-example-3-embedding-c-code-within-kepler-no-cpos" title="Permalink to this headline">¶</a></h2>
<p><strong>Exercise no. 3</strong></p>
<p><em>Embedding simple C++ code within Kepler (no CPOs)</em></p>
<p>(approx. 30 min)</p>
<p><strong>The knowledge gained</strong>
<strong>After this exercise you will:</strong></p>
<ul class="simple">
<li>know how to prepare C++ codes for FC2K</li>
<li>know how to prepare C++ library</li>
<li>know how set up Makefile</li>
<li>know how start and configure FC2K tool</li>
</ul>
<p>In this exercise you will execute simple C++ code within Kepler. In order to do this follow the instructions:</p>
<div class="section" id="id14">
<h3>11.8.1. Get familiar with codes that will be incorporated into Kepler<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Go to Code Camp related materials within your home directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd $TUTORIAL_DIR/FC2K/simplecppactor_nocpo</span>
</pre></div>
</div>
<p>You can find there various files. Pay particular attention to following ones:</p>
<ul class="simple">
<li>simplecppactornocpo.cpp - C++ source code that will be executed from Kepler</li>
<li>Makefile - makefile that allows to build library file</li>
<li>simplecppactor_nocpo_fc2k.xml - parameters for FC2K application (NOTE! this file contains my own settings, we will modify them during tutorial)</li>
<li>simplecppactor_nocpo_workflow.xml - example workflow</li>
</ul>
</div>
<div class="section" id="id15">
<h3>11.8.2. Build the code by issuing<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; make clean</span>
<span class="go">shell&gt; make</span>
</pre></div>
</div>
<p>Codes are ready to be used within FC2K</p>
</div>
<div class="section" id="id16">
<h3>11.8.3. Prepare environment for FC2K<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>Make sure that all required system settings are correctly set</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3>11.8.4. Start FC2K application<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>This is as simple as typing fc2k from terminal</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; fc2k</span>
</pre></div>
</div>
<p>After a while, you should see FC2K’s main window</p>
</div>
<div class="section" id="open-project-simplecppactor-nocpo">
<h3>11.8.5. Open project simplecppactor_nocpo<a class="headerlink" href="#open-project-simplecppactor-nocpo" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Choose <strong>File -&gt; Open</strong></li>
<li>Navigate to $TUTORIAL_DIR/FC2K/simplecppactor_nocpo</li>
<li>Open file simplecppactor_nocpo_fc2k.xml.</li>
<li>You should see new project loaded into FC2K.</li>
</ol>
<img alt="_images/kepler_29.png" class="align-center" src="_images/kepler_29.png" />
</div>
<div class="section" id="id18">
<h3>11.8.6. Project settings<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>Please take a look at the project settings.</p>
<img alt="_images/kepler_30.png" class="align-center" src="_images/kepler_30.png" />
<p>Function arguments:</p>
<ul class="simple">
<li>one input argument - double</li>
<li>one output argument - double</li>
</ul>
<img alt="_images/kepler_31.png" class="align-center" src="_images/kepler_31.png" />
<p>After loading parameters you can notice that library location points to location within your $TUTORIAL_DIR directory.</p>
</div>
<div class="section" id="actor-generation">
<h3>11.8.7. Actor generation<a class="headerlink" href="#actor-generation" title="Permalink to this headline">¶</a></h3>
<p>After all the settings are correct, you can generate actor</p>
<p>Simply press “Generate” button and wait till FC2K finishes the generation.</p>
</div>
<div class="section" id="id19">
<h3>11.8.8. Confirm Kepler compilation<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>After actor is generated, FC2K offers to compile Kepler application. Make sure to compile it by pressing “Yes”.</p>
<img alt="_images/kepler_32.png" class="align-center" src="_images/kepler_32.png" />
</div>
<div class="section" id="id20">
<h3>11.8.9. You can now start Kepler and use generated actor<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Open new terminal window and make sure that all environment settings are correctly set and execute Kepler.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
<span class="go">shell&gt; kepler</span>
</pre></div>
</div>
<p>After Kepler is started, open example workflow from the following location</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>TUTORIAL_DIR/FC2K/simplecppactor_nocpo/simplecppactor_nocpo_workflow.xml
</pre></div>
</div>
<p>You should see similar workflow on screen.</p>
<img alt="_images/kepler_33.png" class="align-center" src="_images/kepler_33.png" />
</div>
<div class="section" id="id21">
<h3>11.8.10. Launch the workflow<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>You can start the workflow, by pressing “Play” button</p>
<img alt="_images/kepler_34.png" class="align-center" src="_images/kepler_34.png" />
<p>After workflow finishes it’s execution, you should see result similar to one below:</p>
<img alt="_images/kepler_35.png" class="align-center" src="_images/kepler_35.png" />
<p>Exercise no. 3 finishes here.</p>
</div>
</div>
<div class="section" id="fc2k-example-4-embedding-c-code-within-kepler-cpos">
<span id="exercise4"></span><h2>11.9. FC2K - Example 4 - Embedding C++ code within Kepler (CPOs)<a class="headerlink" href="#fc2k-example-4-embedding-c-code-within-kepler-cpos" title="Permalink to this headline">¶</a></h2>
<p><strong>Exercise no. 4</strong></p>
<p><em>C++ code within Kepler (CPO handling)</em></p>
<p>(approx. 30 min)</p>
<p><strong>The knowledge gained:</strong>
<strong>After this exercise you will:</strong>
- know how to prepare C++ codes for FC2K
- know how to prepare C++ library
- know how set up Makefile
- know how start and configure FC2K tool
In this exercise you will execute simple C++ code within Kepler. In order to do this follow the instructions:</p>
<div class="section" id="id22">
<h3>11.9.1. Get familiar with codes that will be incorporated into Kepler<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>Go to Code Camp related materials within your home directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; cd $TUTORIAL_DIR/FC2K/simplecppactor</span>
</pre></div>
</div>
<p>You can find there various files. Pay particular attention to following ones:</p>
<ul class="simple">
<li>simplecppactor.cpp - C++ source code that will be executed from Kepler</li>
<li>Makefile - makefile that allows to build library file</li>
<li>simplecppactor_fc2k.xml - parameters for FC2K application (NOTE! this file contains my own settings, we will modify them during tutorial)</li>
<li>simplecppactor_workflow.xml - example workflow</li>
</ul>
</div>
<div class="section" id="id23">
<h3>11.9.2. Build the code by issuing<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; make clean</span>
<span class="go">shell&gt; make</span>
</pre></div>
</div>
<p>Codes are ready to be used within FC2K</p>
</div>
<div class="section" id="id24">
<h3>11.9.3. Prepare environment for FC2K<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>Make sure that all required system settings are correctly set</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h3>11.9.4. Start FC2K application<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>This is as simple as typing fc2k from terminal</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; fc2k</span>
</pre></div>
</div>
<p>After a while, you should see FC2K’s main window.</p>
</div>
<div class="section" id="open-project-simplecppactor">
<h3>11.9.5. Open project simplecppactor<a class="headerlink" href="#open-project-simplecppactor" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Choose <strong>File -&gt; Open</strong></li>
<li>Navigate to $TUTORIAL_DIR/FC2K/simplecppactor.</li>
<li>Open file simplecppactor_fc2k.xml.</li>
<li>You should see new parameter settings loaded into FC2K.</li>
</ol>
<img alt="_images/kepler_36.png" class="align-center" src="_images/kepler_36.png" />
</div>
<div class="section" id="id26">
<h3>11.9.6. Project settings<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>Please take a look at the project settings.</p>
<img alt="_images/kepler_37.png" class="align-center" src="_images/kepler_37.png" />
<p>Function arguments:</p>
<ul class="simple">
<li>input argument - equilibrium</li>
<li>input argument - double</li>
<li>output argument - double</li>
</ul>
<img alt="_images/kepler_38.png" class="align-center" src="_images/kepler_38.png" />
<p>You should modify these setting, so they point to locations within you home directory. They will typically be as follows:</p>
</div>
<div class="section" id="id27">
<h3>11.9.7. Actor generation<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>After all the settings are correct, you can generate actor
Simply press “Generate” button and wait till FC2K finishes the generation.</p>
</div>
<div class="section" id="id28">
<h3>11.9.8. Confirm Kepler compilation<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>After actor is generated, FC2K offers to compile Kepler application. Make sure to compile it by pressing “Yes”.</p>
<img alt="_images/kepler_39.png" class="align-center" src="_images/kepler_39.png" />
</div>
<div class="section" id="id29">
<h3>11.9.9. You can now start Kepler and use generated actor<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>Open new terminal window and make sure that all environment settings are correctly set and execute Kepler.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">shell&gt; source $ITMSCRIPTDIR/ITMv1 kepler test 4.10b &gt; /dev/null</span>
<span class="go">kepler.sh</span>
</pre></div>
</div>
<p>After Kepler is started, open example workflow from the following location</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">shell&gt; $</span>TUTORIAL_DIR/FC2K/simplecppactor/simplecppactor_workflow.xml
</pre></div>
</div>
<p>You should see similar workflow on screen.</p>
<img alt="_images/kepler_40.png" class="align-center" src="_images/kepler_40.png" />
<p>Launch the workflow</p>
<p>You can start the workflow, by pressing “Play” button</p>
<img alt="_images/kepler_41.png" class="align-center" src="_images/kepler_41.png" />
<p>After workflow finishes it’s execution, you should see result similar to one below:</p>
<img alt="_images/kepler_42.png" class="align-center" src="_images/kepler_42.png" />
<p>Exercise no. 4 finishes here.</p>
</div>
</div>
<div class="section" id="imas-kepler-2-1-3-default-release">
<h2>11.10. IMAS Kepler 2.1.3 (default release)<a class="headerlink" href="#imas-kepler-2-1-3-default-release" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installation-of-default-version-of-kepler-without-actors">
<h3>11.10.1. Installation of default version of Kepler (without actors)<a class="headerlink" href="#installation-of-default-version-of-kepler-without-actors" title="Permalink to this headline">¶</a></h3>
<p>In order to use most recent version of Kepler do following. First of all make sure you have directory imas-kepler inside your $HOME</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> in case you already have imas-kepler inside $HOME</span>
<span class="go"> you can move it to $ITMWORK/imas-kepler</span>
<span class="gp">&gt;</span> mv <span class="nv">$HOME</span>/imas-kepler <span class="nv">$ITMWORK</span>/imas-kepler

<span class="go"> If you don&#39;t have $HOME/imas-kepler directory, create</span>
<span class="go"> it inside $ITMWORK</span>
<span class="gp">&gt;</span> mkdir <span class="nv">$ITMWORK</span>/imas-kepler

<span class="go"> create symbolic link inside $HOME</span>
<span class="gp">&gt;</span> <span class="nb">cd</span> <span class="nv">$HOME</span>
<span class="gp">&gt;</span> ln -s <span class="nv">$ITMWORK</span>/imas-kepler
</pre></div>
</div>
<p>Then, you can load imasenv module by calling</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module load imasenv
</pre></div>
</div>
<p>If there is no Kepler version installed, you will be informed by message</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">WARNING: Cannot find /afs/eufus.eu/user/..../imas-kepler/2.5p2-2.1.3... Run kepler_install_light before running kepler;</span>
<span class="go">INFO: setting KEPLER=/gw/swimas/extra/kepler/2.5p2-2.1.3;</span>
<span class="go">IMAS environment loaded.</span>
<span class="go">Please do not forget to set database by calling &#39;imasdb &lt;machine_name&gt;&#39; !</span>
</pre></div>
</div>
<p>In that case, call kepler_install_light - you will see installation process running in your terminal.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler_install_light
<span class="go">Warning: $KEPLER_INSTALL_PATH override by environment: /afs/eufus.eu/user/g/g2michal/imas-kepler/2.5p2-2.1.3</span>
<span class="go">mkdir: created directory ?/afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3?</span>
<span class="go">sending incremental file list</span>
<span class="go">.ptolemy-compiled</span>
<span class="go">build-area/</span>
<span class="go">build-area/README.txt</span>
<span class="go">build-area/build.xml</span>
<span class="go">build-area/current-suite.txt</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">?gui? -&gt; ?gui-2.5?</span>
<span class="go">?common? -&gt; ?common-2.5?</span>
<span class="go">Done installing /afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3.</span>
<span class="go">Run `module switch kepler/2.5p2-2.1.3` to update $KEPLER to match.</span>
<span class="go">Then run `kepler` to try your lightweight installation.</span>
</pre></div>
</div>
<p>You have to switch module, to make sure that KEPLER variable points to proper location.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module switch kepler/2.5p2-2.1.3
</pre></div>
</div>
<p>Once you have set version of Kepler, you can run it by typing kepler</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler
<span class="go">The base dir is /afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3</span>
<span class="go">Kepler.run going to run.setMain(org.kepler.Kepler)</span>
<span class="go">JVM Memory: min = 1G,  max = 8G, stack = 20m, maxPermGen = default</span>
<span class="go">adding $CLASSPATH to RunClassPath: /gw/switm/jaxfront/R1.0/XMLParamForm.jar:/gw/switm/jaxfront/R1.0/jaxfront-core.jar:/gw/switm/jaxfront/R1.0/jaxfront-swing.jar:/gw/switm/jaxfront/R1.0/xercesImpl.jar:/gw/swimas/core/imas/3.20.0/ual/3.8.3/jar/imas.jar</span>
<span class="go">...</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-of-dressed-version-of-kepler-with-actors">
<h3>11.10.2. Installation of “dressed” version of Kepler (with actors)<a class="headerlink" href="#installation-of-dressed-version-of-kepler-with-actors" title="Permalink to this headline">¶</a></h3>
<p>In order to use most recent version of Kepler (with actors) do following. First of all make sure you have directory imas-kepler inside your $HOME</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> mkdir <span class="nv">$HOME</span>/imas-kepler
</pre></div>
</div>
<p>Then, you can load imasenv module by calling</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module load imasenv
</pre></div>
</div>
<p>If there is no Kepler version installed, you will be informed by message</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">WARNING: Cannot find /afs/eufus.eu/user/..../imas-kepler/2.5p2-2.1.3... Run kepler_install_light before running kepler;</span>
<span class="go">INFO: setting KEPLER=/gw/swimas/extra/kepler/2.5p2-2.1.3;</span>
<span class="go">IMAS environment loaded.</span>
<span class="go">Please do not forget to set database by calling &#39;imasdb &lt;machine_name&gt;&#39; !</span>
</pre></div>
</div>
<p>You have to switch to “dressed” version of Kepler by calling</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module switch kepler/2.5p2-2.1.3_IMAS_3.20.0
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler_install_light
<span class="go">Warning: $KEPLER_INSTALL_PATH override by environment: /afs/eufus.eu/user/g/g2michal/imas-kepler/2.5p2-2.1.3_IMAS_3.20.0</span>
<span class="go">mkdir: created directory ?/afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler?</span>
<span class="go">mkdir: created directory ?/afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3_IMAS_3.20.0?</span>
<span class="go">...</span>
<span class="go">...</span>
<span class="go">Done installing /afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3_IMAS_3.20.0.</span>
<span class="go">Run `module switch kepler/2.5p2-2.1.3_IMAS_3.20.0` to update $KEPLER to match.</span>
<span class="go">Then run `kepler` to try your lightweight installation.</span>
</pre></div>
</div>
<p>You have to switch module, to make sure that KEPLER variable points to proper location.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module switch kepler/2.5p2-2.1.3_IMAS_3.20.0
</pre></div>
</div>
<p>Once you have set version of Kepler, you can run it by typing kepler</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler
<span class="go">The base dir is /afs/eufus.eu/g2itmdev/user/g2michal/imas-kepler/2.5p2-2.1.3_IMAS_3.20.0</span>
<span class="go">Kepler.run going to run.setMain(org.kepler.Kepler)</span>
<span class="go">JVM Memory: min = 1G,  max = 8G, stack = 20m, maxPermGen = default</span>
<span class="go">...</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="imas-kepler-2-1-5-release-candidate">
<h2>11.11. IMAS Kepler 2.1.5 (release candidate)<a class="headerlink" href="#imas-kepler-2-1-5-release-candidate" title="Permalink to this headline">¶</a></h2>
<p><strong>Most recent steps for Gateway users</strong></p>
<p>In order to use most recent version of Kepler do following. First of all make sure you have directory imas-kepler inside your $HOME</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> mkdir -p <span class="nv">$HOME</span>/imas-kepler/modulefiles
</pre></div>
</div>
<p>Make sure to set IMAS_KEPLER_DIR variable inside .cshrc file</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> <span class="nb">echo</span> <span class="s2">&quot;setenv IMAS_KEPLER_DIR </span><span class="nv">$HOME</span><span class="s2">/imas-kepler&quot;</span> &gt;&gt; ~/.cshrc
</pre></div>
</div>
<p>Now, you can load imasenv/3.21.0 module by calling</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module load imasenv/3.21.0
</pre></div>
</div>
<p>Note that this module uses kepler/2.5p2-2.1.5 instead of kepler/2.5p2-2.1.3</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module load imasenv/3.21.0
<span class="go">IMAS environment loaded.</span>
<span class="go">Please do not forget to set database by calling &#39;imasdb &lt;machine_name&gt;&#39; !</span>
</pre></div>
</div>
<p>Now, you can install your personal Kepler installation (please note that since release 2.5p-2.1.5 and keplertools-1.7.0 it is possible to switch between different installations of Kepler (they will not collide).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler_install my_own_kepler
<span class="go">Using IMAS_KEPLER_DIR at: /pfs/work/g2michal/imas-keplers.</span>
<span class="go">Using KEPLER_SRC from KEPLER: /gw/swimas/extra/kepler/2.5p2-2.1.5.</span>
<span class="go">mkdir: created directory ?/pfs/work/g2michal/imas-keplers/my_own_kepler</span>
<span class="go">mkdir: created directory ?/pfs/work/g2michal/imas-keplers/my_own_kepler/.kepler?</span>
<span class="go">mkdir: created directory ?/pfs/work/g2michal/imas-keplers/my_own_kepler/.ptolemyII?</span>
<span class="go">mkdir: created directory ?/pfs/work/g2michal/imas-keplers/my_own_kepler/KeplerData?</span>
<span class="go">Done installing /pfs/work/g2michal/imas-keplers/my_own_kepler/kepler.</span>
<span class="go">?/gw/swimas/extra/keplertools/1.7.0/share/modulefiles/kepler? -&gt; ?/pfs/work/g2michal/imas-keplers/modulefiles/kepler/my_own_kepler?</span>

<span class="go">Kepler was installed inside /pfs/work/g2michal/imas-keplers/my_own_kepler</span>
<span class="go">Its module file is: /pfs/work/g2michal/imas-keplers/modulefiles/kepler/my_own_kepler</span>
<span class="go">To load this environment, run: module switch kepler/my_own_kepler</span>
<span class="go">To see available installations: module avail kepler</span>
</pre></div>
</div>
<p>As you can see, your personal Kepler installations are available via modules. In order to switch to given version of Kepler you need to switch the module</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> module switch kepler/my_own_kepler
</pre></div>
</div>
<p>Once you have set version of Kepler, you can run it by typing kepler</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> kepler
<span class="go">kepler</span>
<span class="go">The base dir is /marconi_work/eufus_gw/work/g2michal/imas-keplers/my_own_kepler/kepler</span>
<span class="go">Kepler.run going to run.setMain(org.kepler.Kepler)</span>
<span class="go">JVM Memory: min = 1G,  max = 8G, stack = 20m, maxPermGen = default</span>
<span class="go">...</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-based-on-readme-file">
<h2>11.12. Installation based on README file<a class="headerlink" href="#installation-based-on-readme-file" title="Permalink to this headline">¶</a></h2>
<p>Installation instructions based on most recent version of IMAS Kepler</p>
<p>Detailed, up to date, instructions on how to install and switch between different installations of Kepler, can be found here</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> git clone ssh://git@git.iter.org/imex/kepler-installer.git

<span class="gp">&gt;</span> cat kepler-installer/README
</pre></div>
</div>
<p>You can also find latest documentation at following location (Gateway)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;</span> cat <span class="nv">$SWIMASDIR</span>/extra/kepler-installer/README
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="amns.html" class="btn btn-neutral float-right" title="12. AMNS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="conventions.html" class="btn btn-neutral float-left" title="10. Conventions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, WPCD

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>