

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Infrastructure &mdash; EUROfusion Integrated Modelling workflows 3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="EUROfusion Integrated Modelling workflows 3.0 documentation" href="index.html"/>
        <link rel="next" title="Core Transport Simulator (ETS)" href="ets.html"/>
        <link rel="prev" title="Introduction to Code Development for integrated modelling" href="introduction.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> EUROfusion Integrated Modelling workflows
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Code Development for integrated modelling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Infrastructure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#universal-access-layer-ual">Universal Access Layer (UAL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-cpos">Handling CPOs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-deallocate-stuctures">Module deallocate_stuctures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-copy-structures">Module copy_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-euitm-copy">Module euitm_copy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-is-set-structures">Module is_set_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-size-of-structures">Module size_of_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-write-structures">Module write_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-read-structures">Module read_structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-diff-structures">Module diff_structures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ets.html">Core Transport Simulator (ETS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="codes.html">Codes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">EUROfusion Integrated Modelling workflows</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Infrastructure</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/infrastructure.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="infrastructure">
<h1>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this headline">¶</a></h1>
<p>The part of the EU-IM documentation addresses infrastructure related
issues like the EU-IM Gateway, EU-IM database access, the Universal Access
Layer (UAL), and useful tools for handling CPOs.</p>
<div class="section" id="universal-access-layer-ual">
<h2>Universal Access Layer (UAL)<a class="headerlink" href="#universal-access-layer-ual" title="Permalink to this headline">¶</a></h2>
<p>The UAL (Universal Access Layer) is a multi-language library that allows
exchanging Consistent Physical Objects (CPOs) between various modules,
and to write to an EU-IM database. The documentation here is provided for
rather experienced users who want to practice the UAL in their test
programs. Regular KEPLER users do not need to know anything about the
UAL. KEPLER manages transparently the UAL calls, which are embedded in
the physics code wrappers. No UAL calls should be made inside physics
modules. Prior using the UAL, the environment must be configured. It is
recommended to use the <code class="docutils literal"><span class="pre">EU-IMv1</span></code> script for this, which simultanesouly
sets i) the database environment (to the private database of the user)
ii) the UAL libraries environment iii) the Kepler environment.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/EU-IMv1 KEPLERFOLDER</span>
<span class="go">MACHINENAME DATAVERSION</span>
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/EU-IMv1 kepler tore_supra 4.08a</span>
</pre></div>
</div>
<p>This scripts does not prevent you from using databases from other users
or the public one, you must then use the UAL function <code class="docutils literal"><span class="pre">euitm_open_env</span></code>
in your program to do so. The EU-IMv1 script uses the two following
scripts: to set the database environment variables (mandatory prior UAL
usage), use:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/set_itm_data_env USERNAME</span>
<span class="go"> MACHINENAME DATAVERSION</span>
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/set_itm_data_env myname jet 4.08a</span>
</pre></div>
</div>
<p>Then to set the path to the right UAL libraries, use:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/set_itm_env DATAVERSION</span>
</pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">source $EU-IMSCRIPTDIR/set_itm_env 4.08a</span>
</pre></div>
</div>
<p>UAL libraries are installed in /afs.eufus.eu/isip/project/switm/ual.
The source code is stored in a subversion repository in
/afs/edfa-itm.eu/isip/project/portal/gforge/storage/svnroot/ual. To
check out a subversion working copy of the repository, storing it in
subdirectory <em>ual</em>, do</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">svn co https://gforge6.eufus.eu/svn/ual</span>
</pre></div>
</div>
</div>
<div class="section" id="handling-cpos">
<h2>Handling CPOs<a class="headerlink" href="#handling-cpos" title="Permalink to this headline">¶</a></h2>
<p>The tools below allow you to perform useful operations on the EU-IM
datastructures including entire CPOs in your Fortran90 workflows. They
are not meant as a replacement of the Universal Access Layer (UAL) but
rather as a complement especially in situations where the UAL is not
available or not practical, e.g. in U.S. - EFDA collaborations.</p>
<div class="section" id="module-deallocate-stuctures">
<h3>Module deallocate_stuctures<a class="headerlink" href="#module-deallocate-stuctures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module allows you to deallocate in a very simple way any
EU-IM data structure which is defined in euitm_schemas.f90.
Add the following use statement to your code:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">deallocate_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for deallocating a cpo is then:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">deallocate_cpo</span><span class="p">(</span><span class="n">cpo</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo is a single time slice or a pointer array of a CPO (or other
EU-IM data structure). With</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">set_deallocate_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the deallocate routines. verbosity = 0
produces no output, whereas verbosity &gt; 0 produces verbose output. The
module deallocate_structures.f90 is hosted by the Gforge project itmshared.
Check it out with</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/branches/tools target_dir</span>
</pre></div>
</div>
<p>Two static libraries
libdeallocate_pgi.a
and
libdeallocate_g95.a
have been prebuilt on the
EU-IM Gateway
.</p>
</div>
<div class="section" id="module-copy-structures">
<h3>Module copy_structures<a class="headerlink" href="#module-copy-structures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module allows you to copy in a very simple way any EU-IM
data structure which is defined in euitm_schemas.f90.
Add the following use statement to your code:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">set_deallocate_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the deallocate routines. verbosity = 0
produces no output, whereas verbosity &gt; 0 produces verbose output. The
module deallocate_structures.f90 is hosted by the Gforge project itmshared.
Check it out with</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">copy_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for copying a cpo is then:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">copy_cpo</span><span class="p">(</span><span class="n">cpo_source</span><span class="p">,</span> <span class="n">cpo_target</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo_source and cpo_target are single time slices or arrays of a CPO
(or other EU-IM data structure) of the same derived type, real scalars, or
real arrays (1D - 7D). The allocation of the elements of the target
structure is done automatically. With</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">set_copy_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the copy routines. verbosity = 0 produces
no output, whereas verbosity &gt; 0 produces verbose output. The module
copy_structures.f90 is hosted by the Gforge project itmshared . Check it
out with</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/branches/tools target_dir</span>
</pre></div>
</div>
<p>Two static libraries libcopy_pgi.a and libcopy_g95.a have been prebuilt on
the EU-IM Gateway .</p>
</div>
<div class="section" id="module-euitm-copy">
<h3>Module euitm_copy<a class="headerlink" href="#module-euitm-copy" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module allows you to copy in a very simple way any EU-IM
data structure which is defined in euitm_schemas.f90 including entire
trim traces.
Add the following use statement to your code:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">euitm_copy</span>
</pre></div>
</div>
<p>The Fortran syntax for copying a cpo via assignment is then:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="n">cpo_target</span> <span class="o">=</span> <span class="n">cpo_source</span>
</pre></div>
</div>
<p>where cpo_source and cpo_target are single time slices or arrays of a
CPO (or other EU-IM data structure) of the same derived type.
The allocation of the elements of the target structure is done
automatically.
The program files are hosted by the Gforge project
itmshared
.
Check them out with</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/branches/perlcopy target_dir</span>
</pre></div>
</div>
<p>To build the Fortran90 module, run</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">creacopy.pl</span>
</pre></div>
</div>
<p>It takes euitm_schemas.f90 from the directory
$UAL/fortraninterface/
.
Or supply the file from a given directory</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">creacopy.pl $MYDIR/euitm_schemas.f90</span>
</pre></div>
</div>
</div>
<div class="section" id="module-is-set-structures">
<h3>Module is_set_structures<a class="headerlink" href="#module-is-set-structures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module can be used to check whether EU-IM data structures
including entire CPOs have been set. The subroutines in
is_set_structures.f90
write out the name of each element in the data structure together with
&#8216;T&#8217;
if it has been set or
&#8216;F&#8217;
if not.
Add the following use statement to your code:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">is_set_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for checking a cpo is then:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">is_set_cpo</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="s2">&quot;name of cpo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo is a single time slice or an array of a CPO (or other EU-IM data
structure) and &#8220;name of cpo&#8221; is a string containing the name of the CPO.
The module is_set_structures.f90 is hosted by the Gforge project itmshared
. Check it out with</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gforge6</span><span class="p">.</span><span class="n">eufus</span><span class="p">.</span><span class="n">eu</span><span class="o">/</span><span class="n">svn</span><span class="o">/</span><span class="n">itmshared</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">tools</span> <span class="n">target_dir</span>
</pre></div>
</div>
<p>Two static libraries libis_set_pgi.a and libis_set_g95.a have been prebuilt
on the EU-IM Gateway .</p>
</div>
<div class="section" id="module-size-of-structures">
<h3>Module size_of_structures<a class="headerlink" href="#module-size-of-structures" title="Permalink to this headline">¶</a></h3>
<p>The subroutines in
size_of_structures.f90
write out the name of each element in the data structure with its size,
the size of each entire substructure, and the size of the entire CPO.
The size can be given in bytes or in a more human friendly format
depending on the value of the logical parameter
human_readable
. The indentation is done in steps of 2 blanks with an initial
indentation of 1.
The maximum depth to which the results are displayed is specified by a
call to
set_size_of_maxlevel
. Output of empty fields can be suppressed by setting the verbosity to
zero with a call to
set_size_of_verbosity
. In all cases, sums are carried out over all levels.
Add the following use statement to your code:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">use </span><span class="n">size_of_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for calculating the size of a cpo is then:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">size_of_cpo</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">human_readable</span><span class="p">,</span> <span class="s2">&quot;name of cpo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo is a single time slice or an array of a CPO (or other EU-IM data
structure) and &#8220;name of cpo&#8221; is a string containing the name of the CPO.
total_size is an integer and should be set to zero before the call.
human_readable is a flag (true =&gt; human friendly format).
Set the verbosity with:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">set_size_of_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>verbosity = 0 =&gt; no output of empty fields
verbosity &gt; 0 =&gt; full output
Set the maximum depth with:</p>
<div class="highlight-fortran"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">set_size_of_maxlevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
<p>with level being an integer.
The module
size_of_structures.f90
is hosted by the
Gforge
project
itmshared
.
Check it out with</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">svn checkout https://gforge6.eufus.eu/svn/itmshared/branches/tools target_dir</span>
</pre></div>
</div>
<p>Two static libraries libsize_of_pgi.a and libsize_of_g95.a have been
prebuilt on the EU-IM Gateway.</p>
</div>
<div class="section" id="module-write-structures">
<h3>Module write_structures<a class="headerlink" href="#module-write-structures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module can be used to write EU-IM data structures including
entire CPOs to disk.
The corresponding file is opened with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">open_write_file</span><span class="p">(</span><span class="n">unit_no</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
<p>where unit_no is the file handle (integer) and file_name a string with
the file name (possibly including the path).
The file is closed with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">close_write_file</span>
</pre></div>
</div>
<p>Add the following use statement to your code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">write_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for writing a cpo to disk is then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">write_cpo</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="s2">&quot;name of cpo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo is a single time slice or an array of a CPO (or other EU-IM data
structure) and &#8220;name of cpo&#8221; is a string containing the name of the CPO.
With</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">set_write_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the write routines. verbosity = 0
produces no output, whereas verbosity &gt; 0 produces verbose output.
The module
write_structures.f90
is hosted by the
Gforge
project
itmshared
.
Check it out with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gforge6</span><span class="o">.</span><span class="n">eufus</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">svn</span><span class="o">/</span><span class="n">itmshared</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">tools</span> <span class="n">target_dir</span>
</pre></div>
</div>
<p>Two static libraries libwrite_pgi.a and libwrite_g95.a have been prebuilt
on the EU-IM Gateway .</p>
</div>
<div class="section" id="module-read-structures">
<h3>Module read_structures<a class="headerlink" href="#module-read-structures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module can be used to read EU-IM data structures including
entire CPOs from disk.
The corresponding file is opened with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">open_read_file</span><span class="p">(</span><span class="n">unit_no</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
<p>where unit_no is the file handle (integer) and file_name a string with
the file name (possibly including the path).
The file is closed with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">close_read_file</span>
</pre></div>
</div>
<p>Add the following use statement to your code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">read_structures</span>
</pre></div>
</div>
<p>The Fortran syntax for reading a cpo from disk is then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">read_cpo</span><span class="p">(</span><span class="n">cpo</span><span class="p">,</span> <span class="s2">&quot;name of cpo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where cpo is a single time slice or an array of a CPO (or other EU-IM data
structure) and &#8220;name of cpo&#8221; is a string containing the name of the CPO.
The module automatically deallocates any fields already allocated in cpo
and allocates all required fields automatically. It is absolutely
essential that &#8220;name of cpo&#8221; is identical with the one chosen when the
cpo was written.
With</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">set_read_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the read routines. verbosity = 0
produces no output, whereas verbosity &gt; 0 produces verbose output.
The module
read_structures.f90
is hosted by the
Gforge
project
itmshared
.
Check it out with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gforge6</span><span class="o">.</span><span class="n">eufus</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">svn</span><span class="o">/</span><span class="n">itmshared</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">tools</span> <span class="n">target_dir</span>
</pre></div>
</div>
<p>Two static libraries
libread_pgi.a
and
libread_g95.a
have been prebuilt on the
EU-IM Gateway
.</p>
</div>
<div class="section" id="module-diff-structures">
<h3>Module diff_structures<a class="headerlink" href="#module-diff-structures" title="Permalink to this headline">¶</a></h3>
<p>This Fortran90 module can be used to compare two CPOs or other EU-IM data
structures. It was developed to facilitate benchmarks and automated test
suites for the code development. It was kept flexible through the use of
function arguments in the argument list of the subroutines of
diff_structures. This allows the user to specify his own function set
for the analysis and evalutation of the differences between the two
CPOs. A call to diff_cpo simply writes out the result of this user
defined function.
Add the following use statements to your code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">diff_structures</span>
<span class="n">use</span> <span class="n">error_analysis</span>
</pre></div>
</div>
<p>The Fortran syntax for calculating the differences between two cpos is
then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">diff_cpo</span><span class="p">(</span><span class="n">reference_cpo</span><span class="p">,</span> <span class="n">test_cpo</span><span class="p">,</span> <span class="n">name_root</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p>where reference_cpo is the reference CPO or other EU-IM data structure and
test_cpo is the test CPO or other EU-IM data structure.
name_root is a string which defines the root of the field names to be
displayed, e.g. &#8216;equilibrium&#8217;.
func is a function argument to the subroutine diff_cpo. It can be any
user defined function with the following constraints:</p>
<ul>
<li><p class="first">It must be defined inside the module error_analysis (an example
version with various error analysis functions is provided in
error_analysis.f90
).</p>
</li>
<li><p class="first">It follows the structure (dummy arguments, interface, overloading) as
demonstrated in error_analysis.f90. The function always has a header
function with a list of optional dummy arguments. Depending on which
actual arguments are specified, this functions calls the overloaded
function with the correct arguments. The interim function is required
because of Fortran90/95 limitations. The actual error analysis is
carried out inside the overloaded functions. Two fields of these
functions are intent(inout) variables:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">diff_counter</span> <span class="p">:</span> <span class="n">to</span> <span class="n">count</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">difference</span>
<span class="n">error_level</span>  <span class="p">:</span> <span class="n">to</span> <span class="n">allow</span> <span class="k">for</span> <span class="n">sums</span> <span class="ow">or</span> <span class="n">averages</span> <span class="n">over</span> <span class="n">entire</span> <span class="n">CPOs</span> <span class="p">(</span><span class="n">see</span> <span class="n">examples</span><span class="p">)</span>
</pre></div>
</div>
<p>These two variables are private to the error_analysis module.
To access them please use the functions</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_diff_counter</span><span class="p">()</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">get_error_level</span><span class="p">()</span>
</pre></div>
</div>
<p>The function</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">set_error_level</span><span class="p">(</span><span class="n">err_level</span><span class="p">)</span>
</pre></div>
</div>
<p>may be used to specify an initial value for the variable
error_level
.</p>
</li>
</ul>
<p>With</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="n">set_diff_verbosity</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</pre></div>
</div>
<p>you can set a verbosity level for the diff routines. verbosity = 0 produces
no output, whereas verbosity &gt; 0 produces verbose output. The file
check_equilibrium.f90 represents a simple example for a program to compare
two equilibrium CPOs one of which is used as a reference for test cases in
code development. It clearly demonstrates the use of the diff_structures
module. The module diff_structures.f90 and the auxiliary file
error_analysis.f90 and check_equilibrium.f90 are hosted by the Gforge
project itmshared . Check them out with</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gforge6</span><span class="o">.</span><span class="n">eufus</span><span class="o">.</span><span class="n">eu</span><span class="o">/</span><span class="n">svn</span><span class="o">/</span><span class="n">itmshared</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">tools</span> <span class="n">target_dir</span>
</pre></div>
</div>
<p>Two static libraries libdiff_pgi.a and libdiff_g95.a have been prebuilt on
the EU-IM Gateway .</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ets.html" class="btn btn-neutral float-right" title="Core Transport Simulator (ETS)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction to Code Development for integrated modelling" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, WPCD.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>